---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: external-dns
spec:
  project: kube-do-project
  source:
    repoURL: https://github.com/helm/charts.git
    path: stable/external-dns
    # https://github.com/argoproj/argo-cd/issues/1786
    helm:
      parameters:
        - name: provider
          value: digitalocean
        - name: rbac.create
          value: "true"
        - name: digitalocean.apiToken
          #value: $(DIGITAL_OCEAN_TOKEN)
          value: {{ .Values.externalDns.digitalOceanToken }}
        - name: domainFilters
          #value: $(EXTERNAL_DNS_DOMAIN)
          value: {{ .Values.externalDns.domain }}
  destination:
    server: https://kubernetes.default.svc
    namespace: kube-do
